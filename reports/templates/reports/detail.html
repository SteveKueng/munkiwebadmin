{% load report_extras %}
{% load static %}
<div class="modal fade" id="computerDetails">
	<div class="modal-dialog modal-lg">
		<div class="modal-content">
			<div role="tabpanel" class="modal-body" style="padding:0px;">
				<div class="row">
					<div class="col-md-3 text-center">
				  	<img src='https://km.support.apple.com.edgekey.net/kb/securedImage.jsp?configcode={{machine.serial_number|slice:"8:" }}&size=240x240' width="130" />
					</div>

				  <div class="col-md-6">
				    <h2>{% if machine.hostname %}{{ machine.hostname }}{% else %}{{ machine.serial_number }}{% endif %}</h2>
				    <h4><small>
				    {% if additional_info.model_description|length > 1 %}
				      {{ additional_info.model_description }}
				    {% else %}
				      {{ machine.machine_model }}
				    {% endif %}
				    {% if perms.reports.delete_machine and perms.manifests.delete_manifests %}
				    <a href="#" onclick="delete_machine_modal('{% if machine.hostname %}{{ machine.hostname }}{% else %}{{ machine.serial }}{% endif %}', '{{ machine.serial_number }}', '{{manifest_name}}');"><span class="glyphicon glyphicon-trash"></span></a>

				    {% endif %}
				    </small></h4>
<!--				    <div class="btn-group" role="group" aria-label="...">
				      <a href='#' id="Manifest" class="btn btn-default buttons" onclick="getDetail('Manifest', '{{ machine.serial_number }}', '{{manifest_name}}');">Software</a>
				      <a href='#' id="AppleUpdates" class="btn btn-default buttons" onclick="getDetail('AppleUpdates', '{{ machine.serial_number }}');">Apple Updates</a>
				      <a href='#' id="Machine" class="btn btn-default buttons" onclick="getDetail('Machine', '{{ machine.serial_number }}');">System</a>
				      {% if perms.inventory.can_view_inventory %}
				      <a href='#' onclick="getDetail('Inventory', '{{ machine.serial_number }}');" id="Inventory" class="btn btn-default buttons">Inventory</a>
				      {% endif %}
							<a href='#' onclick="getDetail('Staging', '{{ machine.serial_number }}');" id="Staging" class="btn btn-default buttons">Staging</a>
				    </div> -->
				  </div>
				  <!-- <div class="col-md-3 hidden-xs hidden-sm hidden-print" style="text-align: right">
				    <a href="vnc://{{ user.username }}@{{ machine.hostname }}" class="btn btn-default">Screen Sharing</a>
						<a href="ssh://{{ user.username }}@{{ machine.hostname }}" class="btn btn-default">SSH</a>
				  </div> -->
				</div>
				<div>

				  <!-- Nav tabs -->
				  <ul class="nav nav-tabs" role="tablist">
				    <li role="presentation" class="active"><a href="#Software" aria-controls="Software" role="tab" data-toggle="tab">Software</a></li>
				    <li role="presentation"><a href="#AppleUpdates" aria-controls="AppleUpdates" role="tab" data-toggle="tab">Apple Updates</a></li>
				    <li role="presentation"><a href="#System" aria-controls="System" role="tab" data-toggle="tab">System</a></li>
				    <li role="presentation"><a href="#Inventory" aria-controls="Inventory" role="tab" data-toggle="tab">Inventory</a></li>
						<li role="presentation"><a href="#Staging" aria-controls="Staging" role="tab" data-toggle="tab">Staging</a></li>
				  </ul>

				  <!-- Tab panes -->
				  <div class="tab-content" id="detail_content">
						<div role="tabpaneln" class="tab-pane tabDetail active" id="Software" style="overflow:auto; height:100%;">
							      <!--<i id="imgProgress" class="fa fa-spinner fa-pulse fa-4x"></i>-->
											{% for key, item in plist_text.items %}
											<div class="list-group list-group-root well">
													<a href="#" class="list-group-item">{{ key|replace }}</a>
													{% for software in item %}
													<div class="list-group">
    												<a href="#" class="list-group-item">{{ software.name }} <small class="text-muted pull-right">{{ software.manifest}}</small></a>
														{% if software.requires %}
														<div class="list-group" style="padding-left:20px;">
															{% with "required from "|add:software.name as softwareRequires %}
															{% autoescape off %}{{ software.requires|loopDict:softwareRequires }}{% endautoescape %}
															{% endwith %}
												<!--			{% for key, require in software.requires.items %}
												      <a href="#" class="list-group-item">{{ key }}<small class="text-muted pull-right">{{ software.name }} requires</small></a>

															{% endfor %}-->
												    </div>
														{% endif %}
														{% if software.updates %}
														<div class="list-group" style="padding-left:20px;">
															{% with "update for "|add:software.name as softwareUpdateFor %}
															{% autoescape off %}{{ software.updates|loopDict:softwareUpdateFor }}{% endautoescape %}
															{% endwith %}
												    </div>
														{% endif %}
													</div>
												{% endfor %}
											</div>
											{% endfor %}
						</div>
				    <div role="tabpanel" class="tab-pane tabDetail" id="AppleUpdates">
							<table class="table table-striped">
    						<tbody>
									{% for item in report_plist.MachineInfo.SystemProfile.0.SPInstallHistoryDataType|dictsortreversed:'install_date' %}
										{% if item.package_source == "package_source_apple"%}
										<tr><td class="text-center" style="width:25px;"><img src='{% get_static_prefix %}/img/appleupdate.png' width="20"/></td>
										<td>{{ item|get:"_name" }}</td><td>{{ item.install_version }}</td><td>{{ item.install_date|date:"d. F Y" }}</td></tr>
										{% endif %}
									{% endfor %}
								</tbody>
							</table>
						</div>
				    <div role="tabpanel" class="tab-pane tabDetail" id="System">
							<div class="panel-body">
							<h3>Basic</h3>
							<div class="row">
								<div class="col-lg-6">
									<div class="panel panel-default">
										 <div class="panel-heading">Software</div>
											<div class="panel-body">
									<dl class="dl-horizontal">
										<script>
											$('#osversion').popover();
										</script>
  									<dt>Last-User</dt>
  									<dd>{{ report_plist.ConsoleUser }}</dd>
  									<dt>Munki-Version</dt>
  									<dd>{{ report_plist.MachineInfo.munki_version }}</dd>
										<dt>OS-Version</dt>
  									<dd>{{ report_plist.MachineInfo.SystemProfile.0.SPSoftwareDataType.0.os_version }} <i id="osversion" class="fa fa-info-circle" type="button" data-toggle="popover" data-container="body" data-placement="top" data-content="Kernel-Version: {{ report_plist.MachineInfo.SystemProfile.0.SPSoftwareDataType.0.kernel_version }}" aria-hidden="true"></i></dd>
										<dt>Boot-Volume</dt>
  									<dd>{{ report_plist.MachineInfo.SystemProfile.0.SPSoftwareDataType.0.boot_volume }}</dd>
										<dt>Uptime</dt>
  									<dd>{{ time.0 }} days {{ time.1 }} hours {{ time.2 }} minutes</dd>
									</dl>
								</div>
							</div>
							</div>
								<div class="col-lg-6">
									<div class="panel panel-default">
										 <div class="panel-heading">Hardware</div>
											<div class="panel-body">
												<dl class="dl-horizontal">
  												<dt>Hardware-Type</dt>
  												<dd>{{ report_plist.MachineInfo.SystemProfile.0.SPHardwareDataType.0.machine_model }}</dd>
													<dt>Serial-No</dt>
  												<dd>{{ report_plist.MachineInfo.SystemProfile.0.SPHardwareDataType.0.serial_number }}</dd>
													<dt>Processor</dt>
  												<dd>{{ report_plist.MachineInfo.SystemProfile.0.SPHardwareDataType.0.cpu_type }} {{ report_plist.MachineInfo.SystemProfile.0.SPHardwareDataType.0.current_processor_speed }} {{ report_plist.MachineInfo.SystemProfile.0.SPHardwareDataType.0.number_processors }} Cores</dd>
													<dt>Physical-Memory</dt>
  												<dd>{{ report_plist.MachineInfo.SystemProfile.0.SPHardwareDataType.0.physical_memory }}</dd>
												</dl>
											</div>
										</div>
									</div>
								</div>

							<h3>Disks</h3>
							<ul class="list-group">
		  					<li class="list-group-item">
									<div class="row">
										<div class="col-lg-2">
											<div class="row">
												<div class="col-lg-12 text-center">
													<i class="fa fa-hdd-o" aria-hidden="true" style="font-size: 50px"></i>
												</div>
											</div>
											<div class="row">
												<div class="col-lg-12 text-center">MODEL</div>
											</div>
											<div class="row">
												<div class="col-lg-12 text-center">CAPACITY</div>
											</div>
										</div>
										<div class=col-lg-10>
											<div class="row">
												<div class="col-lg-12">
														<div>PARTITION_NAME<span class="pull-right">FREE_CAPACITY/CAPACITY</span></div>
													<div class="progress">
									  				<div class="progress-bar progress-bar-warning progress-bar-striped" style="width: 30%">
									    				<span class="sr-only">40% System-partition (warning)</span>
									  				</div>
														<div class="progress-bar progress-bar-warning" style="width: 10%">
									    				<span class="sr-only">40% System-partition (warning)</span>
									  				</div>
									  				<div class="progress-bar progress-bar-info progress-bar-striped" style="width: 40%">
									    				<span class="sr-only">60% User-Partition (info)</span>
									  				</div>
														<div class="progress-bar progress-bar-info" style="width: 20%">
									    				<span class="sr-only">60% User-Partition (info)</span>

									  				</div>
													</div>
												</div>
											</div>
										</div>
									</div>
								</li>
		  					<li class="list-group-item">{{ report_plist }}</li>
		  					<li class="list-group-item">Disk 3</li>
							</ul>
							<h3>Screens</h3>
							<div class="row">
								<div class="col-lg-6">
									<div class="row">
										<div class="col-lg-12"><i class="fa fa-television" aria-hidden="true" style="font-size: 70px"></i></div>
									</div>
									<div class="row">
										<div class="col-lg-12">Apple Cinema Display</div>
									</div>
									<div class="row">
										<div class="col-lg-12">1400 x 70</div>
									</div>
								</div>
								<div class="col-lg-6"></div>
							</div>
						</div>
						</div>
				    <div role="tabpanel" class="tab-pane tabDetail" id="Inventory">Inventory</div>
						<div role="tabpanel" class="tab-pane tabDetail" id="Staging">Staging</div>
				  </div>

				</div>


				<div id="data">
				</div>
			<div class="modal-footer">
				{% if perms.manifests.change_manifestfile %}
				<div class='pull-right hidden' id='save_and_cancel'>
					<button type="button" class="btn btn-danger" data-toggle="modal" data-target="#cancelEditConfirmationModal">Cancel</button>
					<button type="button" class="btn btn-success" onClick="saveManifestItem()">Save</button>
				</div>
				{% endif %}
				<div class='pull-right' id='cancel'>
					{% if not perms.pkgsinfo.change_pkginfofile %}<span class="bg-danger">You don't have permissions to make changes here.</span>{% endif %}
					<button type="button" class="btn" onClick="cancelEdit()">Cancel</button>
				</div>
			</div>
		</div><!-- /.modal-content -->
	</div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<!--
Bootstrap modal for confirming manifest deletion
-->
<div class="modal fade" id="deleteConfirmationModal" data-backdrop="false">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h4 class="modal-title">Delete manifest?</h4>
			</div>
			<div class="modal-body">
				<p>Really delete <strong>{{ pathname }}</strong>?</p>
				<p>This action cannot be undone.</p>
				<br>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-danger" data-dismiss="modal"  onClick="deleteManifestItem()">Delete</button>
				<button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
			</div>
		</div><!-- /.modal-content -->
	</div><!-- /.modal-dialog -->
</div><!-- /.modal -->
<!--
Bootstrap modal for confirming canceling editing
-->
<div class="modal fade" id="cancelEditConfirmationModal" data-backdrop="false">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h4 class="modal-title">Discard your changes?</h4>
			</div>
			<div class="modal-body">
				<p>Really discard your changes to <strong>{{ pathname }}</strong>?</p>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-danger" data-dismiss="modal"  onClick="cancelEdit()">Discard Changes</button>
				<button type="button" class="btn btn-default" data-dismiss="modal">Continue Editing</button>
			</div>
		</div><!-- /.modal-content -->
	</div><!-- /.modal-dialog -->
</div><!-- /.modal -->
<!--
Bootstrap modal for saving or canceling when loading a different manifest
-->
<div class="modal fade" id="saveOrCancelConfirmationModal" data-backdrop="false">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h4 class="modal-title">Save your changes?</h4>
			</div>
			<div class="modal-body">
				<p>Save your changes to <strong>{{ pathname }}</strong> before proceeding?</p>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
				<button type="button" class="btn btn-danger" data-dismiss="modal"  onClick="discardChangesAndLoadNext()">Discard Changes</button>
				<button type="button" class="btn btn-success" data-dismiss="modal" onClick="saveChangesAndLoadNext()">Save Changes</button>
			</div>
		</div><!-- /.modal-content -->
	</div><!-- /.modal-dialog -->
</div><!-- /.modal -->
