{% load report_extras %}
{% load staticfiles %}
<div class="modal fade" id="computerDetails">
	<div class="modal-dialog modal-lg">
		<div class="modal-content">
			<div role="tabpanel" class="modal-body" style="padding:0px;">
				<div class="row">
					<div class="col-md-3 text-center">
				  	<img src='https://km.support.apple.com.edgekey.net/kb/securedImage.jsp?configcode={{machine.serial_number|slice:"8:" }}&size=240x240' width="130" />
					</div>

				  <div class="col-md-6">
				    <h2>{% if machine.hostname %}{{ machine.hostname }}{% else %}{{ machine.serial_number }}{% endif %}</h2>
				    <h4><small>
				    {% if additional_info.model_description|length > 1 %}
				      {{ additional_info.model_description }}
				    {% else %}
				      {{ machine.machine_model }}
				    {% endif %}
				    {% if perms.reports.delete_machine and perms.manifests.delete_manifests %}
				    <a href="#" onclick="delete_machine_modal('{% if machine.hostname %}{{ machine.hostname }}{% else %}{{ machine.serial }}{% endif %}', '{{ machine.serial_number }}', '{{manifest_name}}');"><span class="glyphicon glyphicon-trash"></span></a>

				    {% endif %}
				    </small></h4>
<!--				    <div class="btn-group" role="group" aria-label="...">
				      <a href='#' id="Manifest" class="btn btn-default buttons" onclick="getDetail('Manifest', '{{ machine.serial_number }}', '{{manifest_name}}');">Software</a>
				      <a href='#' id="AppleUpdates" class="btn btn-default buttons" onclick="getDetail('AppleUpdates', '{{ machine.serial_number }}');">Apple Updates</a>
				      <a href='#' id="Machine" class="btn btn-default buttons" onclick="getDetail('Machine', '{{ machine.serial_number }}');">System</a>
				      {% if perms.inventory.can_view_inventory %}
				      <a href='#' onclick="getDetail('Inventory', '{{ machine.serial_number }}');" id="Inventory" class="btn btn-default buttons">Inventory</a>
				      {% endif %}
							<a href='#' onclick="getDetail('Staging', '{{ machine.serial_number }}');" id="Staging" class="btn btn-default buttons">Staging</a>
				    </div> -->
				  </div>
				  <!-- <div class="col-md-3 hidden-xs hidden-sm hidden-print" style="text-align: right">
				    <a href="vnc://{{ user.username }}@{{ machine.hostname }}" class="btn btn-default">Screen Sharing</a>
						<a href="ssh://{{ user.username }}@{{ machine.hostname }}" class="btn btn-default">SSH</a>
				  </div> -->
				</div>
				<div>

				  <!-- Nav tabs -->
				  <ul class="nav nav-tabs" role="tablist">
				    <li role="presentation" class="active"><a href="#Software" aria-controls="Software" role="tab" data-toggle="tab">Software</a></li>
				    <li role="presentation"><a href="#AppleUpdates" aria-controls="AppleUpdates" role="tab" data-toggle="tab">Apple Updates</a></li>
				    <li role="presentation"><a href="#System" aria-controls="System" role="tab" data-toggle="tab">System</a></li>
				    <li role="presentation"><a href="#Inventory" aria-controls="Inventory" role="tab" data-toggle="tab">Inventory</a></li>
						<li role="presentation"><a href="#Staging" aria-controls="Staging" role="tab" data-toggle="tab">Staging</a></li>
				  </ul>

				  <!-- Tab panes -->
				  <div class="tab-content" id="detail_content">
						<div role="tabpaneln" class="tab-pane tabDetail active" id="Software" style="overflow:auto; height:100%;">
							      <!--<i id="imgProgress" class="fa fa-spinner fa-pulse fa-4x"></i>-->
											{% for key, item in plist_text.items %}
											<div class="list-group list-group-root well">
													<a href="#" class="list-group-item">{{ key|replace }}</a>
													{% for software in item %}
													<div class="list-group">
    												<a href="#" class="list-group-item">{{ software.name }} <small class="text-muted pull-right">{{ software.manifest}}</small></a>
														{% if software.requires %}
														<div class="list-group" style="padding-left:20px;">
															{% with "required from "|add:software.name as softwareRequires %}
															{% autoescape off %}{{ software.requires|loopDict:softwareRequires }}{% endautoescape %}
															{% endwith %}
												<!--			{% for key, require in software.requires.items %}
												      <a href="#" class="list-group-item">{{ key }}<small class="text-muted pull-right">{{ software.name }} requires</small></a>

															{% endfor %}-->
												    </div>
														{% endif %}
														{% if software.updates %}
														<div class="list-group" style="padding-left:20px;">
															{% with "update for "|add:software.name as softwareUpdateFor %}
															{% autoescape off %}{{ software.updates|loopDict:softwareUpdateFor }}{% endautoescape %}
															{% endwith %}
												    </div>
														{% endif %}
													</div>
												{% endfor %}
											</div>
											{% endfor %}
						</div>
				    <div role="tabpanel" class="tab-pane tabDetail" id="AppleUpdates">
							<table class="table table-striped">
    						<tbody>
									{% for item in report_plist.MachineInfo.SystemProfile.0.SPInstallHistoryDataType|dictsortreversed:'install_date' %}
										{% if item.package_source == "package_source_apple"%}
										<tr><td class="text-center" style="width:25px;"><img src='{% static "img/appleupdate.png" %}' width="20"/></td>
										<td>{{ item|get:"_name" }}</td><td>{{ item.install_version }}</td><td>{{ item.install_date|date:"d. F Y" }}</td></tr>
										{% endif %}
									{% endfor %}
								</tbody>
							</table>
						</div>
				    <div role="tabpanel" class="tab-pane tabDetail" id="System">
							<div class="panel-body">
							<h3>Basic</h3>
							<div class="row">
								<div class="col-lg-6">
									<ul class="list-group">
										<li class="list-group-item"><b>Last-User:</b><span class="pull-right">{{ report_plist.ConsoleUser }}</span></li>
										<li class="list-group-item"><b>Munki-Version:</b><span class="pull-right">{{ report_plist.MachineInfo.munki_version }}</span></li>
										<li class="list-group-item"><b>OS-Version:</b><span class="pull-right">{{ report_plist.MachineInfo.SystemProfile.0.SPSoftwareDataType.0.os_version }}  <i id="osversion" class="fa fa-info-circle" type="button" data-toggle="popover" data-container="body" data-placement="top" data-content="Kernel-Version: {{ report_plist.MachineInfo.SystemProfile.0.SPSoftwareDataType.0.kernel_version }}" aria-hidden="true"></i></span></li>
										<li class="list-group-item"><b>Boot-Volume</b><span class="pull-right">{{ report_plist.MachineInfo.SystemProfile.0.SPSoftwareDataType.0.boot_volume }}</span></li>
										<li class="list-group-item"><b>Uptime:</b><span class="pull-right">{% if time.0 != "0" %}{{ time.0  }} days{% endif %} {% if time.1 != "0" %}{{ time.1 }} hours{% endif %} {% if time.2 != "0" %}{{ time.2 }} minutes{% endif %}</span></li>
										<script>
											$('#osversion').popover();
										</script>
									</ul>
								</div>
								<div class="col-lg-6">
									<ul class="list-group">
										<li class="list-group-item"><b>Hardware-Type:</b><span class="pull-right">{{ report_plist.MachineInfo.SystemProfile.0.SPHardwareDataType.0.machine_model }}</span></li>
										<li class="list-group-item"><b>Serial-No:</b><span class="pull-right">{{ report_plist.MachineInfo.SystemProfile.0.SPHardwareDataType.0.serial_number }}</span></li>
										<li class="list-group-item"><b>Processor:</b><span class="pull-right">{{ report_plist.MachineInfo.SystemProfile.0.SPHardwareDataType.0.cpu_type }} {{ report_plist.MachineInfo.SystemProfile.0.SPHardwareDataType.0.current_processor_speed }} {{ report_plist.MachineInfo.SystemProfile.0.SPHardwareDataType.0.number_processors }} Cores</span></li>
										<li class="list-group-item"><b>Physical-Memory:</b><span class="pull-right">{{ report_plist.MachineInfo.SystemProfile.0.SPHardwareDataType.0.physical_memory }}</span></li>
									</ul>
											</div>
										</div>
								<a role="button" data-toggle="collapse" href="#collapseExample" aria-expanded="false" aria-controls="collapseExample"><h3></a>Drives</h3>
							<ul class="list-group">
									{% for device in disksList %}
		  					<li class="list-group-item">
									<div class="row">
										<div class="col-lg-2" style="" >
											<div class="row">
												<div class="col-lg-12 text-center" >
													<i class="fa fa-hdd-o" aria-hidden="true" style="font-size: 50px"></i>
													{% if device.physicalDisk.is_internal_disk == 'no' %}
															<div style="margin-left: 65px; margin-top: -28px"><i class="fa fa-plug" aria-hidden="true" style="font-size: 20px;"></i></div>
													{% endif %}
												</div>
											</div>
											<div class="row">
												<div class="col-lg-12 text-center">{{ device.diskName }}</div>
											</div>

										</div>
										<div class="col-lg-10" >
											<div class="row" style="border-left: 1px solid #ddd">
													<div class="col-lg-12">
														<h5 style="margin-top: 0px">Basic</h5>
															<div class="row">
																<div class="col-lg-6">

																	<ul class="list-group">
	  																<li class="list-group-item"><b>Disk-Size:</b><span class="pull-right">{{device.diskSize|filesizeformat}}</span></li>
	  																<li class="list-group-item"><b>Protocol:</b><span class="pull-right">{{device.physicalDisk.protocol}}</span></li>
																	</ul>
																</div>
																<div class="col-lg-6">
																	<ul class="list-group">
																		<li class="list-group-item"><b>Internal:</b><span class="pull-right">{% if device.physicalDisk.is_internal_disk == 'yes' %} <i class="fa fa-check" aria-hidden="true"></i> {% else %} <i class="fa fa-times" aria-hidden="true"></i> {% endif %}</span></li>
																	</ul>
																</div>
															</div>
														</div>
												</div>
											{% for partition in device.partitions %}
											<div class="row" style="border-left: 1px solid #ddd; margin-top: 20px">
												<div class="col-lg-12">
													<span class="pull-right">{{ partition.partitionAtributes.free_space_in_bytes|filesizeformat }} / {{partition.partitionAtributes.size_in_bytes|filesizeformat}}</span>
													<h5 style="margin-top: 0px">{{ partition.partitionName }}</h5>
													<div class="progress" style="margin-bottom: 0px;">
  												<div class="progress-bar" role="progressbar" aria-valuenow="{{partition.partitionAtributes.percentFull}}" aria-valuemin="0" aria-valuemax="100" style="width: {{partition.partitionAtributes.percentFull}}%; ">
    										<span class="sr-only">60% Complete</span>
  												</div>
												</div>
												</div>
											</div>
											{% endfor %}
												</div>
									</div>
								</li>
								{% endfor %}
							</ul>
							<a role="button" data-toggle="collapse" href="#collapseExample2" aria-expanded="false" aria-controls="collapseExample"><h3></a>Graphics</h3>
							<ul class="list-group">
									{% for card in report_plist.MachineInfo.SystemProfile.0.SPDisplaysDataType %}
		  					<li class="list-group-item">
									<div class="row">
										<div class="col-lg-2" style="" >
											<div class="row">
												<div class="col-lg-12 text-center" >
													{% if "Intel" in card.sppci_model %}
													<img style="width: 70px;" src="{% static "img/Intel.gif" %}" />
													{% elif "NVIDIA" in card.sppci_model %}
													<img style="width: 70px;" src="{% static "img/nvidia.gif" %}" />
													{% elif "amd" in card.sppci_model %}
													<img style="width: 70px;" src="{% static "img/AMD.gif" %}" />
													{% else %}
													<img style="width: 70px;" src="{% static "img/Graphic-card-icon.png" %}" />
													{% endif %}
												</div>
											</div>
											<div class="row" style="margin-top: 5px">
												<div class="col-lg-12 text-center">{{ card.sppci_model }}</div>
											</div>

										</div>
										<div class="col-lg-10" >

											<div class="row" style="border-left: 1px solid #ddd">
												<div class="col-lg-12">

												<div class="row">
													<div class="col-lg-6">
														<ul class="list-group">
															<li class="list-group-item"><b>Video-RAM:</b><span class="pull-right">{% if card.spdisplays_vram  %}{{ card.spdisplays_vram }}{% else %}{{ card|get:"_spdisplays_vram" }}{% endif %}</span></li>
														</ul>
													</div>
													<div class="col-lg-6">
														<ul class="list-group">
		  												<li class="list-group-item"><b>Card-Type:</b><span class="pull-right">{{ card.sppci_bus|slice:"11:"|replace }}</span></li>
														</ul>
													</div>
													</div>
												</div>
											</div>

											{% for screen in card.spdisplays_ndrvs %}
											<div class="row" style="border-left: 1px solid #ddd; margin-top: 20px">
												<div class="col-lg-2">
													{% if screen.spdisplays_builtin == "spdisplays_yes" %}
														<i class="fa fa-laptop" aria-hidden="true" style="font-size: 70px"></i>
													{% else %}
														<i class="fa fa-television" aria-hidden="true" style="font-size: 70px"></i>
													{% endif %}
												</div>
												<div class="col-lg-5">
													<ul class="list-group">
  													<li class="list-group-item"><b>Name:</b><span class="pull-right">{{ screen|get:"_name" }}</span></li>
  													<li class="list-group-item"><b>Resolution (Max):</b><span class="pull-right">{{ screen|get:"_spdisplays_pixels" }}</span></li>
														<li class="list-group-item"><b>Resolution (Set):</b><span class="pull-right">{{ screen|get:"_spdisplays_resolution" }}</span></li>
  													<li class="list-group-item"><b>Type:</b><span class="pull-right">{{ screen.spdisplays_display_type|slice:"11:"}}</li>
													</ul>
												</div>
												<div class="col-lg-5">
													<ul class="list-group">
														<li class="list-group-item"><b>Serial-No:</b><span class="pull-right">{% if screen|get:"spdisplays_display-serial-number" %}{{ screen|get:"spdisplays_display-serial-number" }}{% else %}No Data{% endif %}</span></li>
														<li class="list-group-item"><b>Year of purchase:</b><span class="pull-right">{{ screen|get:"_spdisplays_display-year" }}</span></li>
														<li class="list-group-item"><b>Internal:</b><span class="pull-right">{% if screen.spdisplays_builtin == "spdisplays_yes" %}<i class="fa fa-check" aria-hidden="true"></i>{% else %}<i class="fa fa-times" aria-hidden="true"></i>{% endif %}</li>
														<li class="list-group-item"><b>Supports rotation:</b><span class="pull-right">{% if screen.spdisplays_rotation == "spdisplays_supported"  %}<i class="fa fa-check" aria-hidden="true"></i>{% else %}<i class="fa fa-times" aria-hidden="true"></i>{% endif %}</li>
													</ul>
												</div>
											</div>
											{% endfor %}
												</div>
									</div>
								</li>
								{% endfor %}
							</ul>
						</div>
						</div>
				    <div role="tabpanel" class="tab-pane tabDetail" id="Inventory">Inventory</div>
						<div role="tabpanel" class="tab-pane tabDetail" id="Staging">Staging</div>
				  </div>

				</div>


				<div id="data">
				</div>
			<div class="modal-footer">
				{% if perms.manifests.change_manifestfile %}
				<div class='pull-right hidden' id='save_and_cancel'>
					<button type="button" class="btn btn-danger" data-toggle="modal" data-target="#cancelEditConfirmationModal">Cancel</button>
					<button type="button" class="btn btn-success" onClick="saveManifestItem()">Save</button>
				</div>
				{% endif %}
				<div class='pull-right' id='cancel'>
					{% if not perms.pkgsinfo.change_pkginfofile %}<span class="bg-danger">You don't have permissions to make changes here.</span>{% endif %}
					<button type="button" class="btn" onClick="cancelEdit()">Cancel</button>
				</div>
			</div>
		</div><!-- /.modal-content -->
	</div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<!--
Bootstrap modal for confirming manifest deletion
-->
<div class="modal fade" id="deleteConfirmationModal" data-backdrop="false">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h4 class="modal-title">Delete manifest?</h4>
			</div>
			<div class="modal-body">
				<p>Really delete <strong>{{ pathname }}</strong>?</p>
				<p>This action cannot be undone.</p>
				<br>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-danger" data-dismiss="modal"  onClick="deleteManifestItem()">Delete</button>
				<button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
			</div>
		</div><!-- /.modal-content -->
	</div><!-- /.modal-dialog -->
</div><!-- /.modal -->
<!--
Bootstrap modal for confirming canceling editing
-->
<div class="modal fade" id="cancelEditConfirmationModal" data-backdrop="false">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h4 class="modal-title">Discard your changes?</h4>
			</div>
			<div class="modal-body">
				<p>Really discard your changes to <strong>{{ pathname }}</strong>?</p>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-danger" data-dismiss="modal"  onClick="cancelEdit()">Discard Changes</button>
				<button type="button" class="btn btn-default" data-dismiss="modal">Continue Editing</button>
			</div>
		</div><!-- /.modal-content -->
	</div><!-- /.modal-dialog -->
</div><!-- /.modal -->
<!--
Bootstrap modal for saving or canceling when loading a different manifest
-->
<div class="modal fade" id="saveOrCancelConfirmationModal" data-backdrop="false">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h4 class="modal-title">Save your changes?</h4>
			</div>
			<div class="modal-body">
				<p>Save your changes to <strong>{{ pathname }}</strong> before proceeding?</p>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
				<button type="button" class="btn btn-danger" data-dismiss="modal"  onClick="discardChangesAndLoadNext()">Discard Changes</button>
				<button type="button" class="btn btn-success" data-dismiss="modal" onClick="saveChangesAndLoadNext()">Save Changes</button>
			</div>
		</div><!-- /.modal-content -->
	</div><!-- /.modal-dialog -->
</div><!-- /.modal -->
